---
sidebar: sidebar 
permalink: upgrade/task_upgrade_andu_cli.html 
keywords: netapp, ontap, automate, automatic, automated, upgrade, nondisruptive, nondisruptively, non-disruptive update, nondisruptive upgrade, upgrade a cluster, shift workload between clusters, hardware platform, configuration, software image, update, update ONTAP, update software, ndu 
summary: Sie können die ONTAP Version auf Ihrem Cluster unterbrechungsfrei aktualisieren. 
---
= Automatisiertes, unterbrechungsfreies ONTAP Upgrade über die CLI
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Bei automatisierten Upgrades installiert ONTAP automatisch das Ziel-ONTAP-Image auf jedem Node, validiert die Cluster-Komponenten, um sicherzustellen, dass das Cluster unterbrechungsfrei aktualisiert werden kann und führt anschließend eine aus xref:concept_upgrade_methods.html[Batch- oder Rolling-Upgrade] Im Hintergrund basierend auf der Anzahl der Nodes.

Über die Befehlszeilenschnittstelle (CLI) können Sie überprüfen, ob ein unterbrechungsfreies Upgrade des Clusters durchgeführt werden kann, das Ziel-ONTAP Image auf jedem Node installieren und anschließend im Hintergrund ein Upgrade ausführen.


NOTE: Wenn Sie den Fortschritt des Upgrade-Prozesses nicht überwachen möchten, empfehlen wir Ihnen, es in dieser Übung zu verwenden link:task_requesting_notification_of_issues_encountered_in_nondisruptive_upgrades.html["Anforderung von EMS-Benachrichtigungen über Fehler, die möglicherweise manuelles Eingreifen erfordern"].

.Bevor Sie beginnen
* Sollten Sie link:prepare.html["Bereiten Sie sich auf das Upgrade vor"].
* Sollten Sie link:download-software-image.html["Laden Sie das ONTAP Software Image herunter"] Für die ONTAP-Version, die Sie als Ziel haben.
* Bei jedem HA-Paar sollte jeder Node einen oder mehrere Ports auf derselben Broadcast-Domäne nutzen.
+
Bei 8 oder mehr Nodes wird die Batch-Upgrade-Methode bei dem automatischen unterbrechungsfreien Upgrade verwendet. Wenn in ONTAP 9.7 und älteren Versionen die Batch-Methode verwendet wird, werden LIFs zum HA-Partner des Node migriert, der aktualisiert wird. Falls die Partner keine Ports in derselben Broadcast-Domäne haben, schlägt die LIF-Migration fehl.

+
Wenn in ONTAP 9.8 und höher die Batch-Methode verwendet wird, werden LIFs zur anderen Batch-Gruppe migriert.

* Wenn Sie eine ausführen link:https://docs.netapp.com/us-en/ontap/upgrade/concept_upgrade_paths.html#types-of-upgrade-paths["Direktes Multi-Hop-Upgrade"], Sie müssen beide der richtigen ONTAP-Bilder für Ihre spezifischen erhalten haben link:https://docs.netapp.com/us-en/ontap/upgrade/concept_upgrade_paths.html#supported-upgrade-paths["Upgrade-Pfad"].
* Wenn Sie ein Upgrade von ONTAP in einer MetroCluster FC-Konfiguration durchführen, sollte das Cluster für die automatische ungeplante Umschaltung aktiviert sein.



NOTE: Ändern der Einstellung des `storage failover modify-auto-giveback` Befehlsoption vor Beginn eines automatischen unterbrechungsfreien Upgrades (ANDU) hat keine Auswirkung auf den Upgrade-Prozess. Der ANDU Prozess ignoriert während der für das Update erforderlichen Übernahme/Rückgabe jeden voreingestellten Wert für diese Option. Beispiel: Einstellung `-autogiveback` Auf false vor ANDU wird das automatische Upgrade vor dem Giveback nicht unterbrochen.



== Schritt: Laden Sie das ONTAP Ziel-Software-Image in das Cluster-Paket-Repository

Um das ONTAP Software-Upgrade zu starten, müssen Sie das ONTAP Ziel-Software-Image im Cluster-Paket-Repository zur Verfügung stellen.

.Schritte
. Löschen Sie das frühere ONTAP-Softwarepaket:
+
[source, cli]
----
cluster image package delete -version previous_ONTAP_Version
----
. Laden Sie das ONTAP Ziel-Software-Image in das Cluster-Paket-Repository:
+
[source, cli]
----
cluster image package get -url location
----
+
[listing]
----
cluster1::> cluster image package get -url http://www.example.com/software/9.13.1/image.tgz

Package download completed.
Package processing completed.
----
+
Wenn Sie eine ausführen link:https://docs.netapp.com/us-en/ontap/upgrade/concept_upgrade_paths.html#types-of-upgrade-paths["Direktes Multi-Hop-Upgrade"]Sie müssen auch das Softwarepaket für die Zwischenversion von ONTAP laden, die für Ihr Upgrade erforderlich ist. Wenn Sie beispielsweise ein Upgrade von 9.8 auf 9.13.1 durchführen, müssen Sie das Softwarepaket für ONTAP 9.12.1 laden und dann denselben Befehl verwenden, um das Softwarepaket für 9.13.1 zu laden.

. Vergewissern Sie sich, dass das Softwarepaket im Repository für Cluster-Pakete verfügbar ist:
+
[source, cli]
----
cluster image package show-repository
----
+
[listing]
----
cluster1::> cluster image package show-repository
Package Version  Package Build Time
---------------- ------------------
9.13.1              MM/DD/YYYY 10:32:15
----




== Schritt 2: Automatische Prüfungen vor dem Upgrade

Optional können Sie die verwenden, bevor Sie ein automatisiertes Upgrade der ONTAP-Software durchführen `cluster image validate` Befehl, um zu überprüfen, ob ein Upgrade des Clusters erfolgreich durchgeführt werden kann.  Der `cluster image validate` Der Befehl führt eine Reihe von Überprüfungen für Ihre Clusterkomponenten aus, bietet dann eine Liste der durchgeführten spezifischen Validierungen sowie eine Liste aller Korrekturmaßnahmen, die vor dem Upgrade durchgeführt werden müssen.

. Führen Sie die automatischen Prüfungen vor dem Upgrade durch:
+
[source, cli]
----
cluster image validate -version package_version_number
----
+
** Wenn Sie eine ausführen link:https://docs.netapp.com/us-en/ontap/upgrade/concept_upgrade_paths.html#types-of-upgrade-paths["Direktes Multi-Hop-Upgrade"]Verwenden Sie das Ziel-ONTAP-Paket zur Überprüfung.  Sie müssen das zwischengeschaltete Upgrade-Image nicht separat validieren.  Wenn Sie beispielsweise ein Upgrade von 9.8 auf 9.13.1 durchführen, sollten Sie das Paket 9.13.1 zur Überprüfung verwenden. Sie müssen das Paket 9.12.1 nicht separat validieren.
** Wenn Sie eine MetroCluster Konfiguration mit zwei oder vier Nodes aktualisieren, müssen Sie diesen Befehl auf beiden Clustern ausführen, bevor Sie fortfahren.
+
[listing]
----
cluster1::> cluster image validate -version 9.13.1

WARNING: There are additional manual upgrade validation checks that must be performed after these automated validation checks have completed...
----


. Überwachen Sie den Fortschritt der Validierung:
+
[source, cli]
----
cluster image show-update-progress
----
. Führen Sie alle erforderlichen Aktionen durch, die durch die Validierung identifiziert wurden.




== Schritt 3: Aktualisieren Sie die ONTAP-Software

. Kostenvoranschlag für Software-Upgrades erstellen:
+
[source, cli]
----
cluster image update -version package_version_number -estimate-only
----
+
Die Schätzung für das Software-Upgrade zeigt Details zu jeder zu aktualisienden Komponente sowie die geschätzte Dauer des Upgrades an.

. Durchführen des Software-Upgrades:
+
[source, cli]
----
cluster image update -version package_version_number
----
+
** Wenn Sie eine ausführen link:https://docs.netapp.com/us-en/ontap/upgrade/concept_upgrade_paths.html#types-of-upgrade-paths["Direktes Multi-Hop-Upgrade"], Verwenden Sie die Ziel-ONTAP-Version für das Paket_Version_number. Wenn Sie beispielsweise von ONTAP 9.8 auf 9.13.1 aktualisieren, verwenden Sie 9.13.1 als Paket_Version_number.
** Wenn der Cluster aus 2 bis 6 Nodes besteht, wird ein Rolling Upgrade durchgeführt. Wenn der Cluster aus 8 oder mehr Nodes besteht, wird standardmäßig ein Batch Upgrade durchgeführt. Auf Wunsch können Sie die verwenden `-force-rolling` Parameter, um stattdessen ein Rolling Upgrade anzugeben.
** Nach jedem Takeover und jeder Giveback dauert das Upgrade 8 Minuten, damit die Client-Applikationen nach der I/O-Pause, die während der Übernahme und Rückgabe auftritt, wiederhergestellt werden können. Wenn Ihre Umgebung mehr oder weniger Zeit für die Client-Stabilisierung benötigt, können Sie den verwenden `-stabilize-minutes` Parameter, um eine andere Dauer der Stabilisierung anzugeben.
** Bei jeder MetroCluster-Konfiguration mit Ausnahme eines MetroCluster Systems mit zwei Nodes wird der ONTAP Upgrade-Prozess nach der Initiierung des Benutzers an beiden Standorten (lokaler Standort und Disaster Recovery-Standort) gleichzeitig auf den HA-Paaren gestartet. Dies bestätigt eine Bestätigung über die Befehlszeile. Bei einem MetroCluster-System mit zwei Knoten wird das Update zuerst am Disaster Recovery-Standort, d. h. an dem Standort, an dem das Upgrade nicht initiiert wird, gestartet. Nachdem das Update am Disaster-Recovery-Standort vollständig abgeschlossen ist, beginnt das Upgrade am lokalen Standort.
+
[listing]
----
cluster1::> cluster image update -version 9.13.1

Starting validation for this update. Please wait..

It can take several minutes to complete validation...

WARNING: There are additional manual upgrade validation checks...

Pre-update Check      Status     Error-Action
--------------------- ---------- --------------------------------------------
...
20 entries were displayed

Would you like to proceed with update ? {y|n}: y
Starting update...

cluster-1::>
----


. Zeigt den Status des Cluster-Updates an:
+
[source, cli]
----
cluster image show-update-progress
----
+
Wenn Sie eine MetroCluster Konfiguration mit 4 oder 8 Nodes aktualisieren, wird das angezeigt `cluster image show-update-progress` Befehl zeigt nur den Fortschritt des Node an, auf dem Sie den Befehl ausführen. Sie müssen den Befehl auf jedem Node ausführen, um den Status einzelner Node anzuzeigen.

. Vergewissern Sie sich, dass das Upgrade bei jedem Node erfolgreich abgeschlossen wurde.
+
[source, cli]
----
cluster image show-update-progress
----
+
[listing]
----
cluster1::> cluster image show-update-progress

                                             Estimated         Elapsed
Update Phase         Status                   Duration        Duration
-------------------- ----------------- --------------- ---------------
Pre-update checks    completed                00:10:00        00:02:07
Data ONTAP updates   completed                01:31:00        01:39:00
Post-update checks   completed                00:10:00        00:02:00
3 entries were displayed.

Updated nodes: node0, node1.
----
. AutoSupport-Benachrichtigung auslösen:
+
[source, cli]
----
autosupport invoke -node * -type all -message "Finishing_NDU"
----
+
Wenn Ihr Cluster nicht für das Senden von AutoSupport Meldungen konfiguriert ist, wird eine Kopie der Benachrichtigung lokal gespeichert.

. Vergewissern Sie sich, dass das Cluster für die automatische ungeplante Umschaltung aktiviert ist:
+

NOTE: Dieser Schritt wird nur für MetroCluster FC-Konfigurationen durchgeführt.  Wenn Sie eine MetroCluster IP-Konfiguration verwenden, müssen Sie diesen Schritt nicht ausführen.

+
.. Prüfen, ob die automatische ungeplante Umschaltung aktiviert ist:
+
[source, cli]
----
metrocluster show
----
+
Wenn die automatische ungeplante Umschaltung aktiviert ist, wird die folgende Anweisung in der Befehlsausgabe angezeigt:

+
....
AUSO Failure Domain    auso-on-cluster-disaster
....
.. Wenn die Anweisung nicht in der Ausgabe angezeigt wird, aktivieren Sie die automatische ungeplante Umschaltung:
+
[source, cli]
----
metrocluster modify -auto-switchover-failure-domain auso-on-cluster-disaster -overide-vetoes true
----
+

NOTE: Sie können den Switchback-Vorgang erst durchführen, wenn das automatisierte unterbrechungsfreie Upgrade abgeschlossen ist.

.. Vergewissern Sie sich, dass die automatische ungeplante Umschaltung aktiviert wurde:
+
[source, cli]
----
metrocluster show
----




.Verwandte Informationen
* https://aiq.netapp.com/["Starten Sie Active IQ"]
* https://docs.netapp.com/us-en/active-iq/["Active IQ-Dokumentation"]

