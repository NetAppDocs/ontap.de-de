---
permalink: nas-audit/create-persistent-stores.html 
sidebar: sidebar 
keywords: create, persistent store, fpolicy 
summary: Ab ONTAP 9.14.1 können Sie mit FPolicy einen persistenten Speicher einrichten, um Dateizugriffsereignisse für asynchrone, nicht obligatorische Richtlinien in der SVM zu erfassen. Persistente Speicher können die Client-I/O-Verarbeitung von der FPolicy-Benachrichtigungsverarbeitung entkoppeln, um die Client-Latenz zu verringern. Synchrone und asynchrone obligatorische Konfigurationen werden nicht unterstützt. 
---
= Erstellen persistenter Speicher
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Ab ONTAP 9.14.1 können Sie mit FPolicy eine einrichten link:persistent-stores.html["Persistente Speicher"] So erfassen Sie Dateizugriffsereignisse für asynchrone, nicht obligatorische Richtlinien in der SVM: Persistente Speicher können die Client-I/O-Verarbeitung von der FPolicy-Benachrichtigungsverarbeitung entkoppeln, um die Client-Latenz zu verringern. Synchrone (obligatorische oder nicht obligatorische) und asynchrone obligatorische Konfigurationen werden nicht unterstützt.

.Best Practices in sich vereint
* Bevor Sie die Funktion „persistenter Speicher“ verwenden, stellen Sie sicher, dass Ihre Partneranwendungen diese Konfiguration unterstützen.
* Das persistente Speicher-Volume wird auf SVM-Basis eingerichtet. Für jede FPolicy aktivierte SVM wird ein persistentes Speicher-Volume benötigt.
* Der Name des persistenten Speichervolumes und der bei der Volume-Erstellung angegebene Verbindungspfad müssen übereinstimmen.
* Erstellen Sie das persistente Speicher-Volume auf dem Node mit LIFs, die davon ausgehen, dass der maximale Datenverkehr durch FPolicy überwacht wird.
* Lassen Sie die Snapshot-Richtlinie auf festlegen `none` Für dieses Volume anstelle von `default`. Dadurch wird sichergestellt, dass keine versehentliche Wiederherstellung des Snapshots zum Verlust aktueller Ereignisse führt und eine mögliche doppelte Ereignisverarbeitung verhindert wird.
* Machen Sie das persistente Speicher-Volume für den externen Zugriff auf das Benutzerprotokoll (CIFS/NFS) unzugänglich, um versehentliche Beschädigungen oder das Löschen von permanenten Ereignisdatensätzen zu vermeiden. Um dies zu erreichen, heben Sie nach Aktivierung von FPolicy die Bereitstellung des Volumes in ONTAP auf, um den Verbindungspfad zu entfernen. Dies macht ihn für den Benutzerprotokollzugriff unzugänglich.


.Schritte
. Erstellen Sie ein leeres Volume auf der SVM, das für den persistenten Speicher bereitgestellt werden kann:
+
`volume create -vserver <SVM Name> -volume <volume> -state <online> -junction-path <path> -policy <default> -unix-permissions <777> -size <value> -aggregate <aggregate name> -snapshot-policy <none>`

+
** Die Größe des persistenten Speichervolumes basiert auf der Dauer, für die Sie die Ereignisse, die nicht an den externen Server (Partneranwendung) gesendet werden, fortführen möchten.
+
Wenn Sie beispielsweise möchten, dass in einem Cluster 30 Minuten Ereignisse mit einer Kapazität von 30.000 Benachrichtigungen pro Sekunde erhalten bleiben:

+
Erforderliche Volume-Größe = 30000 x 30 x 60 x 0,6 KB (Größe des Avg-Benachrichtigungsdatensatzes) = 32400000 KB = ~32 GB

+
Um die ungefähre Benachrichtigungsrate zu ermitteln, können Sie sich entweder mit Ihrer FPolicy Partnerapplikation in Verbindung setzen oder den FPolicy-Zähler verwenden `requests_dispatched_rate`.

** Es wird erwartet, dass ein Administratorbenutzer mit ausreichenden RBAC-Berechtigungen (um ein Volume zu erstellen) ein Volume (mit dem cli-Befehl des Volumes oder der REST-API) der gewünschten Größe erstellt und den Namen dieses Volumes als bereitstellt `-volume` Erstellen Sie im persistenten Speicher einen CLI-Befehl oder eine REST-API.


. Persistenten Speicher erstellen:
+
`vserver fpolicy persistent store create -vserver <SVM> -persistent-store <PS_name> -volume <volume>`

+
** Persistenter Speicher: Der Name des persistenten Speichers
** Volume: Das persistente Speicher-Volume


. Nachdem der persistente Speicher erstellt wurde, können Sie die FPolicy-Richtlinie erstellen und dieser Richtlinie den Namen des persistenten Speichers hinzufügen.
Weitere Informationen finden Sie unter link:https://docs.netapp.com/us-en/ontap/nas-audit/create-fpolicy-policy-task.html["Erstellen Sie die FPolicy"].

